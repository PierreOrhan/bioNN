

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>odeUtils module &mdash; BioChemicalNN 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="parse module" href="parseUtils.html" />
    <link rel="prev" title="Neural Network module" href="nnUtils.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: orange" >
          

          
            <a href="index.html" class="icon icon-home"> BioChemicalNN
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="simulOfBioNN.html">SimulOfBioNN package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nnUtils.html">Neural Network module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">odeUtils module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#systemequation">systemEquation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tfderivativenetwork">tfDerivativeNetwork</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-simulOfBioNN.odeUtils.utils">utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parseUtils.html">parse module</a></li>
<li class="toctree-l2"><a class="reference internal" href="plotUtils.html">plot module</a></li>
<li class="toctree-l2"><a class="reference internal" href="simulNN.html">SimulNN module</a></li>
<li class="toctree-l2"><a class="reference internal" href="smallNetworkSimul.html">smallNetworkSimul module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="paretoPlot.html">paretoPlot package</a></li>
<li class="toctree-l1"><a class="reference internal" href="gettingStarted.html">Getting started</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BioChemicalNN</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="simulOfBioNN.html">SimulOfBioNN package</a> &raquo;</li>
        
      <li>odeUtils module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/odeUtils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="odeutils-module">
<h1>odeUtils module<a class="headerlink" href="#odeutils-module" title="Permalink to this headline">¶</a></h1>
<p>Module for solving the ODE evolution of a network of biochemical reaction following mass action on CPU and (in development) on GPU.</p>
<div class="section" id="systemequation">
<h2>systemEquation<a class="headerlink" href="#systemequation" title="Permalink to this headline">¶</a></h2>
<p>Please refer to the following document for detailed explanation:
<a class="reference external" href="https://docs.google.com/presentation/d/1ZayLqDJUJofIbhZDxJycxC7s8eSLk1yoRpdWa8xXkjM/edit?usp=sharing">https://docs.google.com/presentation/d/1ZayLqDJUJofIbhZDxJycxC7s8eSLk1yoRpdWa8xXkjM/edit?usp=sharing</a></p>
<span class="target" id="module-simulOfBioNN.odeUtils.systemEquation"></span><dl class="function">
<dt id="simulOfBioNN.odeUtils.systemEquation.fPython">
<code class="descclassname">simulOfBioNN.odeUtils.systemEquation.</code><code class="descname">fPython</code><span class="sig-paren">(</span><em>speciesA</em>, <em>t</em>, <em>KarrayA</em>, <em>inputStochio</em>, <em>maskA</em>, <em>maskComplementary</em>, <em>derivLeak</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.systemEquation.fPython" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>speciesA</strong> – </p></li>
<li><p><strong>t</strong> – </p></li>
<li><p><strong>KarrayA</strong> – </p></li>
<li><p><strong>inputStochio</strong> – </p></li>
<li><p><strong>maskA</strong> – </p></li>
<li><p><strong>maskComplementary</strong> – </p></li>
<li><p><strong>derivLeak</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.systemEquation.fPythonSparse">
<code class="descclassname">simulOfBioNN.odeUtils.systemEquation.</code><code class="descname">fPythonSparse</code><span class="sig-paren">(</span><em>speciesA</em>, <em>t</em>, <em>KarrayA</em>, <em>inputStochio</em>, <em>maskA</em>, <em>maskComplementary</em>, <em>derivLeak</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.systemEquation.fPythonSparse" title="Permalink to this definition">¶</a></dt>
<dd><p>Computation of the derivative for each species for a system parametrized by sparse matrix.
We use the sparse module. Indeed Numba can’t manage sparsity.
In the current implementation, speciesA should not contains null elements.
derivLeak: a small value to add to the derivative, account for tiny leak</p>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.systemEquation.obtainJacobianMasks">
<code class="descclassname">simulOfBioNN.odeUtils.systemEquation.</code><code class="descname">obtainJacobianMasks</code><span class="sig-paren">(</span><em>karrayA</em>, <em>inputStochio</em>, <em>maskA</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.systemEquation.obtainJacobianMasks" title="Permalink to this definition">¶</a></dt>
<dd><p>It is really easy to derive the jacobian from the way we wrote our system it down
The original function can be applied by just changing the masks</p>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.systemEquation.setToUnits">
<code class="descclassname">simulOfBioNN.odeUtils.systemEquation.</code><code class="descname">setToUnits</code><span class="sig-paren">(</span><em>constants</em>, <em>KarrayA</em>, <em>inputStochio</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.systemEquation.setToUnits" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>This function parametrize the system in simpler range of work.
The three parameters should be the output of the parse function.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>constants</strong> – a d-array with the reaction constant for the equation</p></li>
<li><p><strong>KarrayA</strong> – The array with the reactions</p></li>
<li><p><strong>inputStochio</strong> – The stochiometry</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>karrayA,T0,C0,kdic
karrayA: A new KarrayA with modified values.
T0: value used to rescale with regard to time.
C0: value used to rescale with regard to concentrations.
constants: modified d-array with the reaction constant for the equation</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="tfderivativenetwork">
<h2>tfDerivativeNetwork<a class="headerlink" href="#tfderivativenetwork" title="Permalink to this headline">¶</a></h2>
<span class="target" id="module-simulOfBioNN.odeUtils.tfDerivativeNetwork"></span><p>In this module we propose a neural network as the derivative of the chemical system.
The goal is to be able to be plugged-in directly with tensorflow’s tools.</p>
<dl class="class">
<dt id="simulOfBioNN.odeUtils.tfDerivativeNetwork.derivativeNetwork">
<em class="property">class </em><code class="descclassname">simulOfBioNN.odeUtils.tfDerivativeNetwork.</code><code class="descname">derivativeNetwork</code><span class="sig-paren">(</span><em>deviceIdx</em>, <em>KarrayA</em>, <em>inputStoichio</em>, <em>maskA</em>, <em>maskComplementary</em>, <em>derivLeak</em>, <em>isSparse=False</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.tfDerivativeNetwork.derivativeNetwork" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="simulOfBioNN.odeUtils.tfDerivativeNetwork.derivativeNetwork.call">
<code class="descname">call</code><span class="sig-paren">(</span><em>inputs</em>, <em>training=None</em>, <em>mask=None</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.tfDerivativeNetwork.derivativeNetwork.call" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Compute the derivative for every species, on the device given by self.deviceIdx (set at initialization of the object).</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – 1d-array or tensor of the concentration of input species</p></li>
<li><p><strong>training</strong> – legacy, do not use</p></li>
<li><p><strong>mask</strong> – legacy, do not use</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The derivative for every species in a Tensor.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-simulOfBioNN.odeUtils.utils">
<span id="utils"></span><h2>utils<a class="headerlink" href="#module-simulOfBioNN.odeUtils.utils" title="Permalink to this headline">¶</a></h2>
<p>utilitarians for script</p>
<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.obtainCopyArgs">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">obtainCopyArgs</code><span class="sig-paren">(</span><em>modes</em>, <em>idxList</em>, <em>outputList</em>, <em>time</em>, <em>funcForSolver</em>, <em>speciesArray</em>, <em>KarrayA</em>, <em>stochio</em>, <em>maskA</em>, <em>maskComplementary</em>, <em>coLeak</em>, <em>nameDic</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.obtainCopyArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a list with each elements being a list of parameters used by a sub-process for integration.
The merge is also dependent on the output modes that has been chosen.</p>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.obtainCopyArgsLassie">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">obtainCopyArgsLassie</code><span class="sig-paren">(</span><em>modes</em>, <em>idxList</em>, <em>outputList</em>, <em>time</em>, <em>directory_for_network</em>, <em>parsedEquation</em>, <em>constants</em>, <em>coLeak</em>, <em>nameDic</em>, <em>speciesArray</em>, <em>lassieEx</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.obtainCopyArgsLassie" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a list with each elements being a list of parameters used by a sub-process for integration.
The merge is also dependent on the output modes that has been chosen.
Note that here we give for each thread a directory in which the thread will generate sub-directory for communication with LASSIE.
:param lassieEx: the path to the executive file of lassie.</p>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.obtainOutputArray">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">obtainOutputArray</code><span class="sig-paren">(</span><em>nameDic</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.obtainOutputArray" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Find the output species, that is species of the last layer:
species are sorted as: X_nbLayer_neuronPosition</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>nameDic</strong> – name of all species of our systems.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the sorted list of species from the last layer, which might be interesting to overview.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.obtainSpeciesArray">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">obtainSpeciesArray</code><span class="sig-paren">(</span><em>inputsArray</em>, <em>nameDic</em>, <em>initValue</em>, <em>initializationDic</em>, <em>C0</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.obtainSpeciesArray" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Gives the array with the initial concentration value for all species.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputsArray</strong> – t*d array, where t is the number of test and d number of species in the first layer. Array of concentration for species in the first layer.</p></li>
<li><p><strong>nameDic</strong> – Dictionary, species k index is nameDic[k].</p></li>
<li><p><strong>initValue</strong> – value of concentration all other species should have.</p></li>
<li><p><strong>initializationDic</strong> – dictionary with initialization for other species than the first layer.</p></li>
<li><p><strong>C0</strong> – normalization value, divide all initial value.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>an array of shape t*n, t: number of tests, n: number of species. The initial concentration for all species.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.obtainTemplateArray">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">obtainTemplateArray</code><span class="sig-paren">(</span><em>nameDic=None</em>, <em>layer=None</em>, <em>masks=None</em>, <em>activ=None</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.obtainTemplateArray" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Gives back an array with the template name.
Template are of the form: Templ_X_layerinput_nodeinput_X_layeroutput_nodeinput</p>
<p>This function find the existing template from nameDic if they are provided.
Otherwise it gives back the template with respect to the masks and the previous notations.</p>
<p>One can also aks for template of a specific layer, or for activation or inhibition template.
In these case a mask (list of 2d-array of integer) describing the network, in a neural network like way, must be provided.</p>
<blockquote>
<div><dl class="simple">
<dt>Mask axis are: 1st axis: layers, 2nd axis: output neurons, 3rd axis: input neurons.</dt><dd><p>So if mask[i][j,k]==1, neuron k from layer i-1 activates neurons j from layer i</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nameDic</strong> – dictionary with all species name as keys</p></li>
<li><p><strong>layer</strong> – integer or list of integer, indicate the layer in which the template shall be taken. We consider layer of inputs</p></li>
<li><p><strong>masks</strong> – (list of 2d-array of [-1,0,1]) describing the network, in a neural network like way.</p></li>
<li><p><strong>activ</strong> – if False, consider inhibiting template. If True, consider activator template.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Array with the template names.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.readAttribute">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">readAttribute</code><span class="sig-paren">(</span><em>experiment_name</em>, <em>listToRead</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.readAttribute" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Read the description of the experiment</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> – path where it was saved using saveAttribute function</p></li>
<li><p><strong>listToRead</strong> – list of string from parameters to retrieve from the file</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary with parameters as float.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.rescaleInputConcentration">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">rescaleInputConcentration</code><span class="sig-paren">(</span><em>speciesArray</em>, <em>networkMask=None</em>, <em>nameDic=None</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.rescaleInputConcentration" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>This function enable to rescale concentrations when using more input species, or multi layers.
Such rescale is crucial to obtain output of similar values despite having more species as inputs.
The key point is that these species use shared enzymes of fixed concentration.
As the number of species grows, the competition increases leading to very long reaction.
In order to reduce computation time it is of importance to keep these reactions length in a reasonable amount of time.
To do so, we diminish only the concentration of input species.
One should either gave the network mask or dictionary with all the species names.
Initial version:</p>
<blockquote>
<div><p>A better heuristic should be derived.
For now we simply divide by the total number of nodes in the network.</p>
</div></blockquote>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>speciesArray</strong> – t*n-array, the concentration of every species. t: number of test, n: number of species</p></li>
<li><p><strong>networkMask</strong> – optional, 2d-array with value in {0,1,-1}: mask of the network. (Same as considered by generateNeuralNetworkfunction)
using this is much faster.</p></li>
<li><p><strong>nameDic</strong> – optional, dictionary with name of species of the last layer.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>modified speciesArray,rescaleFactor</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="simulOfBioNN.odeUtils.utils.saveAttribute">
<code class="descclassname">simulOfBioNN.odeUtils.utils.</code><code class="descname">saveAttribute</code><span class="sig-paren">(</span><em>experiment_name</em>, <em>attributesDic</em><span class="sig-paren">)</span><a class="headerlink" href="#simulOfBioNN.odeUtils.utils.saveAttribute" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Save an experiment, for each attribute in attributeDic, save as: attribute + ” has value: ” + value</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>experiment_name</strong> – </p></li>
<li><p><strong>attributesDic</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="parseUtils.html" class="btn btn-neutral float-right" title="parse module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="nnUtils.html" class="btn btn-neutral float-left" title="Neural Network module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pierre Orhan

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>